CREATE OR REPLACE VIEW VIEWS_TOTALORDERS_SALES_RESTAURANT_BY_YEAR AS
      SELECT R.RESTAURANTID,
             R.RESTAURANTNAME,
             EXTRACT(YEAR FROM O.ORDERDATE) YEAR,
             COUNT(O.ORDERID) TOTAL_ORDER,
             SUM(O.SUBTOTAL) TOTAL_SALES
      FROM RESTAURANT R,
           MENU M,
           ORDERDETAILS OD,
           ORDERS O
      WHERE R.RESTAURANTID = M.RESTAURANTID 
        AND M.MENUID       = OD.MENUID 
        AND OD.ORDERID     = O.ORDERID
      GROUP BY R.RESTAURANTID, R.RESTAURANTNAME, EXTRACT(YEAR FROM O.ORDERDATE)
      ORDER BY R.RESTAURANTID, YEAR;

ACCEPT V_YEAR1   DATE     FORMAT 'YYYY'     PROMPT 'Enter value 1st Year (YYYY) : '
ACCEPT V_YEAR2   DATE     FORMAT 'YYYY'     PROMPT 'Enter value 2nd Year (YYYY) : '
ACCEPT V_AMOUNT  NUMBER   FORMAT 9999999.99 PROMPT 'Enter minimum sales amount  : '

TTITLE CENTER 'RESTAURANT PERFORMANCE REPORT' SKIP -
CENTER        'TOTAL ORDERS AND SALES BY &V_YEAR1 AND &V_YEAR2' SKIP -
CENTER        'MINIMUM SALES AMOUNT RM&V_AMOUNT' SKIP -
CENTER        '=======================================' -
RIGHT         'Page: ' FORMAT 999 SQL.PNO SKIP 1 -
LEFT '                      RESTAURANT INFORMATION                          YEAR &V_YEAR1                  YEAR &V_YEAR2' SKIP 1

COLUMN restaurant_ID       FORMAT a10          HEADING 'R_ID'
COLUMN restaurantName      FORMAT a50          HEADING 'Restaurant Name'
COLUMN Year_1_TOTAL_ORDERS FORMAT 9,999,999    HEADING 'Total Orders'
COLUMN Year_1_TOTAL_SALES  FORMAT 9,999,999.99 HEADING 'Total Sales'
COLUMN Year_2_TOTAL_ORDERS FORMAT 9,999,999    HEADING 'Total Orders'
COLUMN Year_2_TOTAL_SALES  FORMAT 9,999,999.99 HEADING 'Total Sales'

SELECT CONCAT('RE', v1.RESTAURANTID) AS restaurant_ID, 
       v1.RESTAURANTNAME, 
       v1.TOTAL_ORDER AS Year_1_TOTAL_ORDERS, 
       v1.TOTAL_SALES AS Year_1_TOTAL_SALES,
       v2.TOTAL_ORDER AS Year_2_TOTAL_ORDERS,
       v2.TOTAL_SALES AS Year_2_TOTAL_SALES
FROM views_TotalOrders_Sales_Restaurant_by_year v1,
     views_TotalOrders_Sales_Restaurant_by_year v2
WHERE v1.restaurantId = v2.restaurantId 
  AND v1.year         = '&V_YEAR1'
  AND v2.year         = '&V_YEAR2'
  AND v1.TOTAL_SALES >= &V_AMOUNT 
  AND v2.TOTAL_SALES >= &V_AMOUNT
ORDER BY restaurant_ID;
CLEAR COLUMNS
TTITLE OFF
