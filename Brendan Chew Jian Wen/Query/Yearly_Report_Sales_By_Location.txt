-- LOGIC
-- CUST | ORDER.ORDERDATE |
-- STATE | MONTH  | TOTAL ORDER | TOTAL SALES AMOUNT 

ACCEPT V_STATE CHAR PROMPT 'Enter Value For State: '
ACCEPT V_YEAR  DATE FORMAT 'YYYY'   PROMPT 'Enter Value Year Format(Yyyy): '

TTITLE CENTER 'Total Orders And Sales Report On Year &V_year In &V_state ' SKIP - 
       CENTER '============================================================' -
       RIGHT  'Page: ' FORMAT 999 SQL.PNO SKIP -

COLUMN STATE        FORMAT A30          HEADING 'State'
COLUMN MONTH        FORMAT A15          HEADING 'Month'
COLUMN TOTAL_ORDERS FORMAT    99,999    HEADING 'Total Orders'
COLUMN TOTAL_SALES  FORMAT 9,999,990.99 HEADING 'Total Sales (RM)'
COLUMN AVG_SALES    FORMAT    99,990.99 HEADING 'Average Sales'
BREAK ON STATE

SELECT R.STATE, 
       TO_CHAR(TO_DATE(EXTRACT(MONTH FROM O.ORDERDATE),'MM'), 'Month') AS MONTH,
       COUNT(O.ORDERID) TOTAL_ORDERS,
       SUM(O.SUBTOTAL) TOTAL_SALES,
       AVG(O.SUBTOTAL) AVG_SALES
FROM RESTAURANT R, 
     MENU M, 
     ORDERDETAILS OD, 
     ORDERS O 
WHERE R.RESTAURANTID = M.RESTAURANTID 
  AND M.MENUID       = OD.MENUID 
  AND OD.ORDERID     = O.ORDERID 
  AND EXTRACT(YEAR FROM O.ORDERDATE) = '&V_YEAR' 
  AND R.STATE        = '&V_STATE'
GROUP BY R.STATE, EXTRACT(MONTH FROM O.ORDERDATE)
ORDER BY EXTRACT(MONTH FROM O.ORDERDATE);

CLEAR COLUMNS
CLEAR BREAKS
TTITLE OFF

-- TEST DATA 
-- KUALA LUMPUR
-- 2017
